<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebMind - AI Web Scanner</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-[#0b0f19] text-[#e2e8f0] m-0">
  
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const FontImport = () => (
      <style>
        {`
          @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
          body { font-family: 'JetBrains Mono', monospace; }
          
          .thinking-dots::after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
          }
          @keyframes dots {
            0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); }
            40% { color: #00f0ff; text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); }
            60% { text-shadow: .25em 0 0 #00f0ff, .5em 0 0 rgba(0,0,0,0); }
            80%, 100% { text-shadow: .25em 0 0 #00f0ff, .5em 0 0 #00f0ff; }
          }
        `}
      </style>
    );

    const formatInline = (text) => {
      const parts = text.split(/(\*\*.*?\*\*)/g);
      return parts.map((part, i) => {
        if (part.startsWith('**') && part.endsWith('**')) {
          return <strong key={i} className="text-white">{part.slice(2, -2)}</strong>;
        }
        return part;
      });
    };

    const formatMarkdown = (text) => {
      if (!text) return null;
      const lines = text.split('\n');
      return lines.map((line, i) => {
        const trimmed = line.trim();
        if (trimmed === '---') {
          return <hr key={i} className="border-[#00f0ff]/30 my-5 shadow-[0_0_10px_rgba(0,240,255,0.2)]" />;
        }
        if (trimmed.startsWith('# ')) {
          return <h1 key={i} className="text-xl font-bold text-[#00f0ff] mb-4 mt-2 drop-shadow-[0_0_5px_rgba(0,240,255,0.5)]">{formatInline(trimmed.slice(2))}</h1>;
        }
        if (trimmed.startsWith('> ')) {
          return <blockquote key={i} className="border-l-4 border-[#00f0ff] bg-[#00f0ff]/10 p-4 rounded-r italic text-gray-200 my-4 shadow-inner">{formatInline(trimmed.slice(2))}</blockquote>;
        }
        return <div key={i} className="mb-2 leading-relaxed">{formatInline(line)}</div>;
      });
    };

    function App() {
      const [url, setUrl] = useState('');
      const [stage, setStage] = useState('input');
      const [progress, setProgress] = useState(0);
      const [messages, setMessages] = useState([]);
      const [inputMessage, setInputMessage] = useState('');
      
      const [siteContent, setSiteContent] = useState('');
      const [error, setError] = useState(null);
      const [isThinking, setIsThinking] = useState(false);
      const [isGeneratingSummary, setIsGeneratingSummary] = useState(false);

      const [showSettings, setShowSettings] = useState(false);
      const [apiKey, setApiKey] = useState(() => localStorage.getItem('webmind_api_key') || '');

      const messagesEndRef = useRef(null);

      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages, isThinking, isGeneratingSummary]);

      const saveApiKey = (key) => {
        setApiKey(key);
        localStorage.setItem('webmind_api_key', key);
      };

      const generateAutoSummary = async (text, currentUrl) => {
        setIsGeneratingSummary(true);
        try {
          const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${apiKey}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              model: 'google/gemini-2.0-flash-001',
              messages: [
                { 
                  role: 'system', 
                  content: `Ð¢Ñ‹ â€” Ð¿Ñ€Ð¾Ð´Ð²Ð¸Ð½ÑƒÑ‚Ñ‹Ð¹ Ð˜Ð˜-Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸Ðº. Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐ¹ Ð¾Ñ‚Ñ‡ÐµÑ‚ Ð¿Ð¾ ÑÐ°Ð¹Ñ‚Ñƒ, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ñ:
Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº: # ðŸ“‘ Ð¦Ð˜Ð¤Ð ÐžÐ’ÐžÐ™ Ð¡Ð›Ð•ÐŸÐžÐš: ${currentUrl}
Ð Ð°Ð·Ð´ÐµÐ»Ð¸ ÐºÐ¾Ð½ÑÐ¿ÐµÐºÑ‚ Ð½Ð° Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð±Ð»Ð¾ÐºÐ¸ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Ð³Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð»Ð¸Ð½Ð¸Ð¹ ---.
Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ Ð¶Ð¸Ñ€Ð½Ñ‹Ð¹ ÑˆÑ€Ð¸Ñ„Ñ‚ Ð´Ð»Ñ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ñ… Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð¾Ð².
Ð¡Ð¿Ð¸ÑÐºÐ¸ Ð´ÐµÐ»Ð°Ð¹ Ñ‡ÐµÑ€ÐµÐ· ÑÐ¼Ð¾Ð´Ð·Ð¸ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, âš¡ Ð´Ð»Ñ Ñ„Ð°ÐºÑ‚Ð¾Ð², ðŸŽ¯ Ð´Ð»Ñ Ñ†ÐµÐ»ÐµÐ¹).
Ð’ ÐºÐ¾Ð½Ñ†Ðµ Ð´Ð¾Ð±Ð°Ð²ÑŒ Ð±Ð»Ð¾Ðº > **Ð’ÐµÑ€Ð´Ð¸ÐºÑ‚:** [Ð¾Ð´Ð½Ð¾ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¾ ÑÑƒÑ‚Ð¸ ÑÐ°Ð¹Ñ‚Ð°].` 
                },
                { role: 'user', content: `ÐŸÑ€Ð¾Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐ¹ Ñ‚ÐµÐºÑÑ‚ Ð¸ Ð²Ñ‹Ð´Ð°Ð¹ Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ð¾Ð¹ ÑÐ»ÐµÐ¿Ð¾Ðº:\n\n${text.substring(0, 40000)}` }
              ]
            })
          });
          
          const data = await response.json();
          if (data.error) throw new Error(data.error.message);
          
          const aiResponse = data.choices[0].message.content;
          setMessages([{ sender: 'bot', text: aiResponse, isSummary: true }]);
        } catch (err) {
          setMessages([{ sender: 'bot', text: `**ÐžÑˆÐ¸Ð±ÐºÐ° Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÑÐ»ÐµÐ¿ÐºÐ°:**\n${err.message}` }]);
        } finally {
          setIsGeneratingSummary(false);
        }
      };

      const startScanning = async () => {
        if (!url.trim()) return;
        setStage('scanning');
        setProgress
